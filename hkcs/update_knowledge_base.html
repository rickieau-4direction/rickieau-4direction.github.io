<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Update HKCS Knowledge Base</title>
    <style>
      :root {
        --bg: #0f1724; /* deep navy */
        --card: #0b1220; /* darker card */
        --accent: #4f46e5; /* indigo */
        --accent-2: #06b6d4; /* teal */
        --muted: #94a3b8;
        --glass: rgba(255, 255, 255, 0.04);
        --glass-2: rgba(255, 255, 255, 0.03);
        --radius: 14px;
      }

      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          Roboto, "Helvetica Neue", Arial;
        background: radial-gradient(
            600px 400px at 10% 10%,
            rgba(79, 70, 229, 0.12),
            transparent 8%
          ),
          radial-gradient(
            500px 300px at 90% 90%,
            rgba(6, 182, 212, 0.08),
            transparent 10%
          ),
          var(--bg);
        color: #eef2ff;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 28px;
      }

      .card {
        width: min(720px, 96%);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.01)
        );
        border-radius: var(--radius);
        box-shadow: 0 10px 30px rgba(2, 6, 23, 0.6),
          inset 0 1px 0 rgba(255, 255, 255, 0.02);
        overflow: hidden;
        display: grid;
        grid-template-columns: 1fr 320px;
        gap: 0;
        min-height: 320px;
      }

      /* Left content */
      .main {
        padding: 42px;
        background: linear-gradient(
          180deg,
          transparent,
          rgba(255, 255, 255, 0.01)
        );
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 18px;
      }

      .eyebrow {
        display: inline-block;
        padding: 6px 10px;
        background: linear-gradient(
          90deg,
          rgba(79, 70, 229, 0.12),
          rgba(6, 182, 212, 0.06)
        );
        color: var(--muted);
        border-radius: 999px;
        font-size: 13px;
        letter-spacing: 0.6px;
        width: max-content;
      }

      h1 {
        margin: 0;
        font-size: 28px;
        line-height: 1.05;
        letter-spacing: -0.02em;
        color: #f8fafc;
      }

      p.lead {
        margin: 0;
        color: var(--muted);
        font-size: 15px;
        max-width: 56ch;
      }

      .meta {
        margin-top: 6px;
        display: flex;
        gap: 12px;
        align-items: center;
        color: var(--muted);
        font-size: 13px;
      }

      .meta .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: linear-gradient(180deg, var(--accent), var(--accent-2));
        box-shadow: 0 3px 10px rgba(79, 70, 229, 0.18);
      }

      /* Right panel */
      .panel {
        padding: 28px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.01),
          rgba(255, 255, 255, 0.02)
        );
        border-left: 1px solid rgba(255, 255, 255, 0.03);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 18px;
      }

      .status {
        width: 100%;
        background: var(--glass);
        border: 1px solid rgba(255, 255, 255, 0.03);
        padding: 14px;
        border-radius: 10px;
        text-align: center;
        color: var(--muted);
        font-size: 14px;
      }

      .btn {
        appearance: none;
        border: 0;
        cursor: pointer;
        padding: 12px 20px;
        font-size: 15px;
        border-radius: 10px;
        color: white;
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        box-shadow: 0 8px 20px rgba(79, 70, 229, 0.18),
          0 1px 0 rgba(255, 255, 255, 0.04) inset;
        transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s;
        display: inline-flex;
        gap: 10px;
        align-items: center;
      }

      .btn:active {
        transform: translateY(1px) scale(0.998);
      }
      .btn[aria-busy="true"] {
        opacity: 0.9;
        pointer-events: none;
        filter: grayscale(0.04);
      }

      .btn .spinner {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.18);
        border-top-color: rgba(255, 255, 255, 0.95);
        animation: spin 0.9s linear infinite;
        display: inline-block;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .small {
        font-size: 13px;
        color: var(--muted);
      }

      /* Footer note */
      .note {
        margin-top: 12px;
        color: var(--muted);
        font-size: 13px;
        text-align: left;
        max-width: 36ch;
      }

      /* Responsive */
      @media (max-width: 720px) {
        .card {
          grid-template-columns: 1fr;
          gap: 0;
          padding: 0;
        }
        .panel {
          order: 2;
          border-left: 0;
          border-top: 1px solid rgba(255, 255, 255, 0.03);
          padding: 18px;
        }
        .main {
          padding: 28px 20px;
        }
      }
    </style>
  </head>
  <body>
    <main class="card" role="main" aria-labelledby="title">
      <section class="main">
        <span class="eyebrow">Knowledge Base</span>
        <h1 id="title">Update knowledge base</h1>
        <p class="lead">
          Keep your AI knowledge base up to date by pulling and indexing the
          latest documents. Click Update when you’re ready — the operation may
          take a few minutes depending on the source size.
        </p>

        <div class="meta" aria-hidden="true">
          <span class="dot" aria-hidden="true"></span>
          <span>Last updated: <strong id="lastUpdated">—</strong></span>
          <span>•</span>
          <span id="itemsIndexed">Items indexed: —</span>
        </div>

        <p class="note">
          Tip: Make sure your data sources are reachable and credentials (if
          any) are configured. You can monitor progress in the status panel.
        </p>
      </section>

      <aside class="panel" aria-labelledby="panelTitle">
        <h2 id="panelTitle" style="margin: 0; font-size: 16px; color: #eef2ff">
          Update
        </h2>

        <div class="status" id="status">Idle — no update in progress</div>

        <button
          id="updateBtn"
          class="btn"
          aria-busy="false"
          title="Start update"
        >
          <span class="label">Update</span>
        </button>

        <div class="small">Estimated time: <strong id="eta">—</strong></div>
      </aside>
    </main>

    <script>
      // Small, friendly interactive behaviour:
      const btn = document.getElementById("updateBtn");
      const status = document.getElementById("status");
      const lastUpdated = document.getElementById("lastUpdated");
      const itemsIndexed = document.getElementById("itemsIndexed");
      const eta = document.getElementById("eta");

      // Simulated update process (replace with real API calls)
      async function simulateUpdate() {
        // Switch to busy state
        btn.setAttribute("aria-busy", "true");
        btn.innerHTML =
          '<span class="spinner" aria-hidden="true"></span><span class="label">Updating…</span>';
        status.textContent = "Connecting to sources…";
        eta.textContent = "estimating…";

        try {
          await wait(800);
          status.textContent = "Fetching documents (0/3)…";
          eta.textContent = "about 2m";
          await wait(1000);

          status.textContent = "Indexing documents (1/3)…";
          itemsIndexed.textContent = "Items indexed: 1";
          await wait(900);

          status.textContent = "Indexing documents (2/3)…";
          itemsIndexed.textContent = "Items indexed: 2";
          await wait(1000);

          status.textContent = "Finalizing (3/3)…";
          itemsIndexed.textContent = "Items indexed: 3";
          await wait(900);

          status.textContent = "Update complete ✔";
          const now = new Date();
          lastUpdated.textContent = now.toLocaleString();
          eta.textContent = "—";
        } catch (err) {
          status.textContent =
            "Update failed: " +
            (err && err.message ? err.message : "unknown error");
        } finally {
          btn.setAttribute("aria-busy", "false");
          btn.innerHTML = '<span class="label">Update</span>';
        }
      }

      function wait(ms) {
        return new Promise((res) => setTimeout(res, ms));
      }

      // Hook up button
      btn.addEventListener("click", async () => {
        // If already busy, ignore
        if (btn.getAttribute("aria-busy") === "true") return;

        // const API_ENDPOINT = "https://hkcschatdev.4dstaging.com/v1/import_git";

        // try {
        //   const resp = await fetch(API_ENDPOINT, {
        //     method: "POST",
        //     headers: {
        //       "Content-Type": "application/json",
        //       // add 'Authorization' or other headers here if required
        //     },
        //     body: JSON.stringify(body),
        //     // credentials: 'include' // enable if you need cookies
        //   });

        //   // Try to parse response as JSON if present
        //   let text = await resp.text();
        //   let parsed;
        //   try {
        //     parsed = text ? JSON.parse(text) : null;
        //   } catch (err) {
        //     parsed = text;
        //   }

        //   if (!resp.ok) {
        //     statusEl.textContent = `Error: ${resp.status} ${
        //       resp.statusText
        //     } — ${
        //       typeof parsed === "string" ? parsed : JSON.stringify(parsed)
        //     }`;
        //   } else {
        //     statusEl.textContent =
        //       "Success: " +
        //       (parsed ? JSON.stringify(parsed) : `Status ${resp.status}`);
        //   }
        // } catch (err) {
        //   // network or CORS error
        //   statusEl.textContent = "Request failed: " + err.message;
        // } finally {
        //   btn.disabled = false;
        //   spinner.style.display = "none";
        // }

        // In a real page you'd call your API, e.g.:
        try {
          btn.setAttribute("aria-busy", "true");
          const API_ENDPOINT =
            "https://hkcschatdev.4dstaging.com/v1/import_git";

          body = {};

          const resp = await fetch(API_ENDPOINT, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              // add 'Authorization' or other headers here if required
            },
            body: JSON.stringify(body),
            // credentials: 'include' // enable if you need cookies
          });

          // Try to parse response as JSON if present
          let text = await resp.text();
          let parsed;
          // handle server response, update status, poll job id, etc.
        } finally {
          btn.setAttribute("aria-busy", "false");
        }

        // For this demo, simulate the update:
        simulateUpdate();
      });

      // Initialize small state (could be loaded from server)
      (function init() {
        lastUpdated.textContent = "never";
        itemsIndexed.textContent = "Items indexed: 0";
        eta.textContent = "—";
      })();
    </script>
  </body>
</html>
